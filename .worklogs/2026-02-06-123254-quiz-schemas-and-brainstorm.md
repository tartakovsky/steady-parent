# Quiz System: Dual Schemas, Quiz Brainstorm, Research Reorganization

**Date:** 2026-02-06 12:32
**Scope:** `landing/src/lib/quiz/quiz-schema.ts`, `landing/src/lib/quiz/quiz-engine.ts`, `landing/src/lib/quiz/potty-training-readiness.json`, `research/quizzes/`, `landing/src/components/quiz/quiz-result.tsx`, `landing/src/components/quiz/result-domain-insight.tsx`, `landing/src/components/quiz/result-action-plan.tsx`

## Summary

1. Reorganized quiz research files into `research/quizzes/` directory
2. Brainstormed and finalized a list of 24 quizzes (10 identity + 14 readiness)
3. Designed and implemented two strict Zod schemas: Type A (Readiness) with 12 refinements and Type B (Identity) with 11 refinements
4. Updated potty training JSON with `quizType` discriminator
5. Added identity quiz TypeScript interfaces to the engine
6. Bumped font sizes on result page components from text-sm to text-base (from prior session, staged but not committed)

## Context & Problem

The quiz system had one schema (readiness/assessment) that works for "Is my child ready for X?" quizzes. But we planned to add identity/classification quizzes ("What's your parenting style?") where the scoring model is fundamentally different:

- **Readiness**: each question → one domain → single point value → result tier by total score
- **Identity**: each answer → distributes points across MULTIPLE personality types → result = primary type + blend percentages

We needed schemas rigid enough to use as structured output constraints for AI quiz generation, preventing the LLM from producing structurally invalid quiz data.

We also needed to decide WHAT quizzes to build, since they'll all be batch-generated by AI once the schemas and prompts are ready.

## Decisions Made

### 1. Two schema types cover all 24 quizzes
- **Chose:** Two separate schemas in one file (`ReadinessQuizDataSchema`, `IdentityQuizDataSchema`) with a `quizType` discriminator field
- **Why:** Every quiz we brainstormed fits one of these two patterns. No third type needed. The discriminator lets the registry auto-select the right engine.
- **Alternatives considered:**
  - Single flexible schema with optional fields — rejected because optional fields let the LLM skip required content
  - Three schemas (adding a "decoder" type) — rejected because decoder quizzes are really just a different UI over the same two scoring models

### 2. Split domain content into level-specific schemas (Type A)
- **Chose:** Three separate schemas: `DomainHighContentSchema` (with required `strength`), `DomainMediumContentSchema` (with required `concern`, `level: literal("medium")`), `DomainLowContentSchema` (with required `concern`, `level: literal("low")`)
- **Why:** The old schema had `strength` and `concern` both optional on a generic `DomainLevelContent`. This meant the LLM could omit `strength` on high-level domains or `concern` on medium/low. The engine only uses strength from high and concern from medium/low, so making them required per level is correct.
- **Alternatives considered:**
  - Keep optional + add refinement — rejected because the refinement is harder to express and the schema description wouldn't guide the LLM as clearly

### 3. Identity quiz option scoring: require ALL type IDs in every option
- **Chose:** Every option's `points` record MUST have an entry for every type ID (including 0)
- **Why:** If the LLM can omit type IDs it considers "0", it might forget types entirely. Requiring all keys forces the LLM to consider every type for every answer choice. The JSON is more verbose but the schema validation is trivial.
- **Alternatives considered:**
  - Allow sparse points (only non-zero) — rejected because LLM forgetfulness would break scoring

### 4. Quiz list: 24 quizzes (10 identity, 14 readiness)
- **Chose:** Final list after multiple rounds of brainstorming and user veto. See `research/quizzes/quiz-ideas.md` for full details.
- **Why:** User vetoed quizzes that were structurally unclear (behavior decoder — "too many behaviors, each would be its own quiz"), not actionable enough ("what does your child need" — too vague), or redundant.
- **Identity keepers:** Parenting Style, Bedtime Battle Style, Repeating Patterns, Worried Parent, Love Language, Kid Describe You, Superpower, Parent at 2AM, Parenting Era, Co-Parent Team
- **Readiness keepers:** Potty Training (done), Kindergarten, Solid Foods, Drop Nap, Sleepover, Second Child, Battery, Screen, Emotional Intelligence, Social Confidence, Communication Safety, Bedtime Routine Builder, Chores, Calm-Down Toolkit

### 5. Backward compatibility approach
- **Chose:** Deprecated aliases (`QuizDataSchema = ReadinessQuizDataSchema`, `QuizDataFromSchema = ReadinessQuizData`) + re-exports of old sub-schema names
- **Why:** Existing code imports `QuizDataSchema` and `QuizDataFromSchema` from `quiz-schema.ts`. These aliases keep everything working while new code uses the explicit names.

## Architectural Notes

### Schema Refinements (what the LLM can't get wrong)

**Type A — 12 refinements:**
1. `questionCount` matches questions array length
2. All questions reference valid domain IDs
3. `domainContent` has entry for every domain
4. Score ranges cover 0→totalMax with no gaps/overlaps
5. Every question has at least one 0-point option
6. `maxPoints` equals actual sum of max option points per domain (NEW — was only in engine.validate())
7. High threshold > medium threshold (NEW)
8. Each domain has at least 2 questions (NEW)
9. Question IDs unique (NEW)
10. Option IDs unique within each question (NEW)
11. Domain record keys match the `id` field inside each domain config (NEW)
12. Result record keys match the `id` field inside each result template (NEW)

**Type B — 11 refinements:**
1. `questionCount` matches questions array length
2. At least 3 types defined
3. Every option has points for EVERY type ID (including 0)
4. Every option awards at least 1 total point
5. Every type is reachable (at least one option gives it >0)
6. No two options in same question have identical point distributions
7. Each question has options favoring at least 2 different types
8. Question IDs unique
9. Option IDs unique within each question
10. Type record keys match the `id` field
11. Every type must be the TOP scorer for at least one option somewhere (prevents unreachable-as-primary types)

### Slug regex
Added `regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/)` to the slug field in QuizMetaSchema — enforces lowercase-with-hyphens URL format.

### Engine types
Added to `quiz-engine.ts` (interfaces only, no engine class changes):
- `QuizMeta` — extracted shared meta interface
- `IdentityType`, `IdentityOption`, `IdentityQuestion`, `IdentityQuizData` — data types
- `IdentityTypeResult`, `IdentityQuizResult` — computed result types
- Added `quizType?: string` to existing `QuizData` interface

### Research reorganization
- `research/quizzes/quizzes.md` — original research (psychology of sharing, PSDQ, BuzzFeed lessons, parenting metaphors)
- `research/quizzes/architecture.md` — copied from `dev_artifacts/worklogs/quiz-system-architecture.md`
- `research/quizzes/quiz-ideas.md` — final 24 quiz list with types, domains, share triggers, URLs

### Font size fix (from prior session)
- Bumped body text in `quiz-result.tsx`, `result-domain-insight.tsx`, `result-action-plan.tsx` from `text-sm` (14px) to `text-base` (16px)
- This was staged before the schema work began

## Information Sources

- `research/quizzes/quizzes.md` — psychology research on quiz sharing, PSDQ framework, parenting style metaphors
- `research/taxonomy_v3.md` — 20 content categories with 245 planned articles (informed quiz topic selection)
- `research/classification_by_category/*.txt` — source article titles per category (verified coverage)
- `landing/src/lib/quiz/potty-training-readiness.json` — reference implementation for Type A
- `.worklogs/2026-02-06-130000-quiz-result-redesign.md` — prior result page redesign context
- `.worklogs/2026-02-06-120000-article-generation-pipeline-experiments.md` — pipeline experiments (informed approach to batch generation)

## Files to Read for Context Restoration

If starting a new session, read these files to restore full context:

**Must read:**
1. `research/quizzes/quiz-ideas.md` — the 24-quiz plan, types, URLs, schema summary
2. `landing/src/lib/quiz/quiz-schema.ts` — both Zod schemas with all refinements
3. `landing/src/lib/quiz/quiz-engine.ts` — engine class + all TypeScript interfaces
4. `landing/src/lib/quiz/potty-training-readiness.json` — reference Type A quiz
5. `landing/src/lib/quiz/generate-quiz.ts` — current LLM generation function (needs updating)
6. This worklog

**Helpful context:**
7. `research/quizzes/quizzes.md` — research on quiz psychology, parenting frameworks
8. `research/quizzes/architecture.md` — system architecture overview
9. `dev_artifacts/worklogs/quiz-system-architecture.md` — original architecture doc
10. `research/taxonomy_v3.md` — content categories (for quiz→article connections)

## Future Plan (What Needs to Be Done)

### Phase 1: Identity Quiz Engine (code)
- Add `IdentityQuizEngine` class to `quiz-engine.ts` (or separate file)
- Scoring: sum points per type across all answers, calculate percentages, determine primary type, build blend array
- `assembleResult()` returns `IdentityQuizResult` with primary type, all types sorted by score, shareable summary
- Update `quiz-url.ts` if URL encoding needs changes for identity quizzes (probably works as-is — still digit-per-question)

### Phase 2: Identity Quiz Result Page (UI)
- New result page layout for identity quizzes: primary type badge + tagline, blend percentage chart, type description, strengths, growth edge, encouragement
- Decide: separate component or same `quiz-result.tsx` with conditional rendering based on `quizType`
- OG image for identity quizzes — show primary type name + tagline
- Share copy for identity quizzes ("I'm a Lighthouse Parent — I guide without hovering")

### Phase 3: Quiz Registry Update
- Update `landing/src/lib/quiz/index.ts` to handle both quiz types
- The registry currently types everything as `QuizData` — needs a union type or separate registries
- `quiz-container.tsx` needs to know which engine to use based on `quizType`

### Phase 4: Generation Prompt Spec
- Create `research/quizzes/quiz-generation-spec.md` — the instruction set for the AI generator
- Rewrite `generate-quiz.ts` system prompt to be comprehensive:
  - Include the potty training quiz as a few-shot example
  - Brand voice rules (warm, wry, never punitive)
  - Scenario-based questions not opinion-based
  - Result tone rules (every result positive/validating)
  - Identity quiz specific: blend percentages, no "wrong" type, shareable taglines
- Add a second generation function for identity quizzes (different schema + prompt)

### Phase 5: Batch Generation
- Generate all 13 Type A quizzes (potty training already done)
- Generate all 10 Type B quizzes
- Validate each against schema
- Manual review pass for tone and quality
- Add all to quiz registry

### Phase 6: Quiz Index Page
- `/quiz/` page listing all available quizzes
- Category grouping or featured quizzes
- SEO optimization per quiz page

## Open Questions / Future Considerations

1. **Should identity quiz results page reuse the existing result components or be entirely new?** The layout is very different (type badge + blend chart vs score ring + domains). Probably new components.
2. **How to handle the quiz index at 24 quizzes?** Need categories or tabs. Maybe "Fun & Shareable" vs "Readiness Assessments" vs "Practical Tools"
3. **Quiz generation quality control** — after batch generation, need a review step. Maybe a validation script that checks tone (no negative framing) in addition to schema.
4. **The 3 "builder" quizzes (bedtime routine, chores, calm-down toolkit)** use Type A schema but their results are "personalized recommendations" not "readiness tiers." The result page rendering will need to handle this differently — the domain content IS the recommendation.
5. **User added quiz URLs** to quiz-ideas.md (e.g., `/quiz/parenting-style/`, `/quiz/bedtime-battle-style/`). These are the slugs — the JSON `meta.slug` should match.
