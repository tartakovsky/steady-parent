# Fix quiz gate race condition and improve email form UX

**Date:** 2026-02-12 21:54
**Scope:** landing/src/components/quiz/likert-quiz.tsx, landing/src/components/quiz/quiz-container.tsx, landing/src/components/blog/freebie-cta.tsx, landing/src/components/landing/navbar.tsx

## Summary
Fixed a race condition where returning users (with saved email in localStorage) still saw the email gate on subsequent quizzes. Improved FreebieCTA success UX to keep the form reusable. Simplified navbar to static menu items.

## Context & Problem
After completing one quiz and submitting an email through the gate, navigating to a second quiz still showed the email gate. The gate should be skipped for returning users who already provided their email (stored in `localStorage` as `sp_subscriber_email`).

## Decisions Made

### Race condition fix
- **Chose:** Consolidate localStorage check into `restoreFromUrl` callback
- **Why:** Two separate useEffects raced on mount — a standalone effect checked localStorage and set `preview=false`, but `restoreFromUrl` (running in its own effect) read `p=1` from the URL and set `preview=true`, overwriting the first effect's result
- **Fix:** Removed the standalone useEffect. Modified `restoreFromUrl` to check localStorage before setting preview: `setPreview(params.get("p") === "1" && !hasSavedEmail)`
- **Applied to:** Both `likert-quiz.tsx` and `quiz-container.tsx` (same pattern)

### FreebieCTA success UX
- **Chose:** Move success state from button text to a separate message below the form, keep form enabled after success
- **Why:** When the gate is used for quiz results, successful submission triggers `setPreview(false)` which unmounts the QuizPreview (including FreebieCTA). The success message was barely visible. More importantly, the form should remain reusable — a user might want to resubmit with a different email
- **Changes:** Clear input on success, don't disable input/button on success (only during loading), show green "Check your inbox" message below form

### Navbar simplification
- **Chose:** Static menu items, removed "use client" and pathname-dependent logic
- **Why:** The dynamic menu that hid the current page's link added complexity for minimal UX benefit. Static links are simpler, consistent, and allow the navbar to be a server component

## Key Files for Context
- `landing/src/components/quiz/likert-quiz.tsx` — Likert quiz container with gate logic
- `landing/src/components/quiz/quiz-container.tsx` — Identity/assessment quiz container with gate logic
- `landing/src/components/quiz/quiz-preview.tsx` — Preview gate component (renders teaser + email CTA)
- `landing/src/components/blog/freebie-cta.tsx` — Reusable email capture form component
- `.worklogs/2026-02-12-215400-quiz-gate-fixes.md` — this worklog
